<html>
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsonstat"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsonstat-utils"></script>
        <script src="js/jsonstat-d3-bar-chart.js"></script>
        
        <style>
            svg {
                font-family: verdana;
            }
            .dragbox {
                width: 300px;
                height: 200px;
                border: 1px solid;
            }

            svg .chart-title {
                font-size: 25px;
            }

            svg .legend-text {
                font-size: 15px;
            }

            svg .legend-title {
                font-size: 15px;
                text-transform: capitalize;
                font-weight: bold;
            }

            svg .x-axis-title, svg .y-axis-title {
                text-transform: capitalize;
                font-size: 15px;
                font-weight: bold;
            }

            .chart-bar-inactive, .chart-legend-inactive { opacity: 0.2; }
            .chart-bar, .legend-key { stroke: black; }
            .chart-bar-mouseover, .chart-legend-mouseover { cursor: pointer; }
            .axis > g > text { font-size: 15px; }
        </style>
    </head>
    <body onload="ready();">
        <script>
            var barchart;

            function init(data) {
                var ds = JSONstat(data);
                    
                var chartOptions = {
                    data: ds,
                    x: 'gender',
                    y: 'measures',
                    z: 'time',
                    yAxisFormat: ',.0f',
                    events: {
                        bar: {
                            click: (d,i,e) => console.log('Clicked ' + d.x + ',' + d.z),
                            mouseOver: (d,i,e) => console.log('Mouse over ' + d.x + ',' + d.z),
                            mouseOut: (d,i,e) => console.log('Mouse out ' + d.x + ',' + d.z)
                        },
                        legendItem: {
                            click: (d,i,e) => console.log('Clicked ' + d),
                            mouseOver: (d,i,e) => console.log('Mouse over ' + d),
                            mouseOut: (d,i,e) => console.log('Mouse out ' + d)
                        },
                        xAxisTitle: {
                            click: (d,e) => console.log('Clicked ' + d.label),
                            mouseOver: (d,e) => console.log('Mouse over ' + d.label),
                            mouseOut: (d,e) => console.log('Mouse out ' + d.label)
                        },
                        yAxisTitle: {
                            click: (d,e) => console.log('Clicked ' + d.label),
                            mouseOver: (d,e) => console.log('Mouse over ' + d.label),
                            mouseOut: (d,e) => console.log('Mouse out ' + d.label)
                        },
                        legendTitle: {
                            click: (d,e) => console.log('Clicked ' + d.label),
                            mouseOver: (d,e) => console.log('Mouse over ' + d.label),
                            mouseOut: (d,e) => console.log('Clicked ' + d.label)
                        }
                    },
                    width: 650,
                    height: 450,
                    target: document.getElementById('chartDiv')
                };

                barchart = JSONstatD3BarChart(chartOptions);
            }

            function ready() {
                d3.json("https://www.nomisweb.co.uk/api/v01/dataset/NM_162_1.jsonstat.json?geography=2013265921...2013265932&date=latestMINUS8-latest&gender=0...2&age=0...4&measure=1,2&measures=20100").then(function(data) {
                    init(data);
                });
                // Read from CSV
                //d3.text("data.csv").then(function(data) {
                //    init(JSONstatUtils.fromCSV(data, { label: 'Imported from CSV' }));
                //});
            }
        </script>
        <div id="chartDiv"></div>
    </body>
</html>